# 目录

[TOC]

# 考试系统使用文档

## 打开程序

- 运行`ExamGUI.exe`进入主程序，登录界面

![image-20230619224509955](D:\mycode\ExamSystemGUI\使用文档.assets\image-20230619224509955.png)

## 登录注册界面

- 登录界面
  - 内置一个管理员账户：admin 密码：admin
  - 内置一个普通账户：test 密码：test
  - 登录后进入主界面
  - 注意
    - 学号密码不能为空

![image-20230619224558607](D:\mycode\ExamSystemGUI\使用文档.assets\image-20230619224558607.png)

- 注册界面
  - 输入13位学号，并重复两次密码即可注册
  - 注意
    - 学号必须为数字
    - 学号必须为13位

![image-20230619224646630](D:\mycode\ExamSystemGUI\使用文档.assets\image-20230619224646630.png)

## 主界面

- 普通账户
  - 左边栏
    - 显示用户名
    - 登出按钮，点击登出，返回登录
  - 右边考试卡片栏
    - 会展示管理员已经发布的考试（内置两套考试）
    - 每个卡片显示考试名称，考试题目数量，考试时间
    - 进入按钮，点击进入按钮可以进入考试界面，进行答题

![image-20230619224716716](D:\mycode\ExamSystemGUI\使用文档.assets\image-20230619224716716.png)

- 管理员账户
  - 左边栏
    - 显示用户名
    - 登出按钮：点击登出，返回登录
    - 新建考试按钮：新建一个考试，跳转至考试基本信息填写
    - 导入考试按钮：从文件导入到系统的数据库中
  - 右边考试卡片栏
    - 会展示每个考试（内置两套考试）
    - 每个卡片显示考试名称，考试题目数量，题库数量，考试时间（随机抽取功能就是从题库中抽取考试题目数量个题目）
    - 编辑按钮：进入考试编辑页面
    - 发布/取消发布按钮：切换发布状态，点击发布，普通用户即可以进入答题
    - 删除按钮：删除该考试
    - 导出按钮：可以单独导出该考试到文件

![image-20230619224800997](D:\mycode\ExamSystemGUI\使用文档.assets\image-20230619224800997.png)

- 新建考试按钮后弹出基本信息界面，填写完成后即可进入编辑界面

![image-20230619225514385](D:\mycode\ExamSystemGUI\使用文档.assets\image-20230619225514385.png)

## 考试界面

- 从题库中随机出题

- 左边栏
  - 显示用户名
  - 显示考试时间（倒计时，时间到了之后自动交卷）
  - 题目跳转按钮：点击即可跳转对应的题目
  - 提交按钮：点击即可提交，并返回主界面
    - 答完所有题会自动判断并弹窗：答对数量/题目总数
  - 放弃按钮：点击放弃考试直接返回主界面
- 右边题目栏
  - 显示题目
  - 点击选项进行作答
  - 下一题按钮：跳转下一题
  - 上一题按钮：跳转上一题

![image-20230619225632519](D:\mycode\ExamSystemGUI\使用文档.assets\image-20230619225632519.png)

- 四种题型展示

![image-20230619230511309](D:\mycode\ExamSystemGUI\使用文档.assets\image-20230619230511309.png)

## 试题编辑界面

- 左边栏
  - 显示用户名
  - 可修改考试名称
  - 可修改需要答题的数量（随机出题的数量）
  - 可修改考试时间
  - 题目跳转按钮：点击即可跳转对应的题目
  - 新建题目按钮：点击即可在最后新建一个题目
  - 保存按钮：保存编辑内容
  - 返回按钮：放弃未保存的修改并返回主界面
- 右边题目栏
  - 可以编辑题干和各个选项
  - 删除按钮：删除该题目
  - 可以选择该题目的正确答案
  - 下一题按钮：跳转下一题
  - 上一题按钮：跳转上一题

![image-20230619225043455](D:\mycode\ExamSystemGUI\使用文档.assets\image-20230619225043455.png)

- 新建题目按钮可以选择不同的题目类型

![image-20230619225319982](D:\mycode\ExamSystemGUI\使用文档.assets\image-20230619225319982.png)



---

# 考试系统开发文档

## 设计需求

- 使用文本文件或 Microsoft Excel 或者数据库存放试题，形成题库。
- 程序每次从题库随机抽取若干道题目形成一张试卷，用户可以依次做试卷上的题目，允许用户向前、向后翻阅试卷上的题目。
- 用户每次做完一个题目必须确定该题目的答案，否则无效。
- 有计时功能，比如指定一张试卷限用时 15 分钟，时间一到用户再无法答题，提示用户提交试卷。
- 用户一旦提交试卷，程序将给出试卷的分值。
- 为了达到反复训练的目的，用户提交试卷后可以继续让程序再出一套试卷。
- 题型可以包括单项选择题或判断题或填空题等。
- 每套试卷及其标准答案可以单独保存。

## 项目结构

- ui：存储各种界面
  - MainInterface：主界面（登录，注册）
  - InnerInterface：内部界面（显示考试列表）
  - ExamInterface：考试界面
  - EditExamInterface：编辑考试界面
  - NewExamInfo：新建考试界面
- components：存储各种组件
  - LoginCard：登录卡片
  - RegisterCard：注册卡片
  - QuestCard：题目卡片
  - EditQuestCard：编辑题目卡片
  - ExamBriefCard：考试简介卡片
- servises：存储各个服务
  - ExamService：考试相关服务（读取考试，保存考试，等）
  - LoginService：登录相关服务
  - RegisterService：注册相关服务
- modules：存储相关类
  - Answer：答案类
  - Exam：考试类
  - Quest：题目类
  - User：用户类
- Util：其他
  - LongLimit：TextField的限制，限制长度
  - NumberLongLimit：TextField的限制，限制数字长度
  - ScreenUtils：获取屏幕尺寸

## 依赖lib

- fastjson-1.2.53：将数据按类转化为json数据方便存储到本地
- af-swing-1.0：美化类，大部分按钮使用该类的内容

## 功能实现

### 文本存放试题

- 使用fastjson将考试列表转化为json并存到txt文件中

- ```java
  //位于ExamService中第45行
  public void saveExam(List<Exam> examList) throws IOException {
      File savedata = new File("data\\exams.txt");
      String data = JSON.toJSONString(examList);
      if(!savedata.exists()){
          savedata.createNewFile();
      }
  
      BufferedWriter bufferedWriter = new BufferedWriter(
          new OutputStreamWriter(new FileOutputStream(savedata), StandardCharsets.UTF_8));
  
      bufferedWriter.write(data);
      bufferedWriter.close();
  }
  ```

- ![image-20230619233843202](D:\mycode\ExamSystemGUI\使用文档.assets\image-20230619233843202.png)

### 随机抽取

- 使用Shuffle随机打乱题库，取前n个作为该次考试的考题

- ```java
  //位于ExamInterface中第44行
  Collections.shuffle(quests);
  List<Quest> randomQuests = quests.subList(0,exam.getQuestNumNeedAns());
  ```

### 题目切换

- 使用CardLayout，使用相应的函数可以切换前一个，后一个，以及任意一道题

- ```java
  //位于ExamInterface第121行
  //插入题目卡片
  for (int i = 0; i < randomQuests.size(); i++) {
      questPanel.add(new QuestCard(randomQuests.get(i),this,i+1),"quest"+i+1);
  }
  
  //设置监听函数
  //下一题
  next.addActionListener(new ActionListener() {
      @Override
      public void actionPerformed(ActionEvent e) {
          cardLayout.next(questPanel);
      }
  });
  //上一题
  pre.addActionListener(new ActionListener() {
      @Override
      public void actionPerformed(ActionEvent e) {
          cardLayout.previous(questPanel);
      }
  });
  //跳转特定题目
  ActionListener toTargetQuest = new ActionListener() {
      @Override
      public void actionPerformed(ActionEvent e) {
          for (int i = 0; i < exam.getQuestNumNeedAns(); i++) {
              if(e.getActionCommand().equals(String.valueOf(i+1))){
                  cardLayout.show(questPanel,"quest"+i+1);
              }
          }
      }
  };
  ```

### 计时功能

- 使用多线程，在进入考试界面的时候，创建计时线程

- ```java
  //位于ExamInterface第72行
  Thread timeCount = new Thread(() -> {
      int sec = 59;
      //获取考试时间
      int min = exam.getTimeLimit() - 1;
      //计时
      for (int i = 0; i < exam.getTimeLimit() * 60; i++) {
          try {
              timeLable.setText("考试时间：" + min + ":" + sec);
              if (min == 0 && sec == 0) {
                  JOptionPane.showMessageDialog(jf, "时间到,自动提交考卷", "提示", JOptionPane.INFORMATION_MESSAGE);
                  scoreAndReturn(exam, randomQuests, true, currentUser);
              }
              Thread.sleep(1000);
              sec--;
              if (sec < 0) {
                  sec = 59;
                  min--;
              }
          } catch (InterruptedException | IOException e) {
              throw new RuntimeException(e);
          }
      }
  });
  timeCount.start();
  ```

### 自动打分

- 用户提交之后，通过比较用户答案和标准答案来打分，最终给出：答对题目/总题目，的形式

- ```java
  //位于ExamInterface第241行
  int correctNum = 0;
  for (Quest quest : quests) {
      if(quest.getCurrentAns()!=null && quest.getCurrentAns().equals(quest.getCorrectAns())){
          correctNum++;
      }
  }
  ```

### 多题型

- 在Quest类中定义四个常量，表示四种题型，对应处理的时候通过判断题目类型做出不同的处理
- 代码具体见附录源码中components/QuestCard和EditQuestCard的代码

### 每套试卷单独保存

- 添加按钮和对应的服务保存单独试卷，添加文件选择器，以便于选择保存路径

- ```java
  //位于ExamService第87行
  public void exportExam(Exam exam, File dir) throws IOException {
      String examName = exam.getExamName();
      File savedata = new File(dir,examName+".txt");
      String data = JSON.toJSONString(exam);
  
      if(!savedata.exists()){
          savedata.createNewFile();
      }
  
      BufferedWriter bufferedWriter = new BufferedWriter(
          new OutputStreamWriter(new FileOutputStream(savedata), StandardCharsets.UTF_8));
  
      bufferedWriter.write(data);
      bufferedWriter.close();
  }
  ```

- ```java
  //位于ExamBriefCard第110行
  //导出考试
  exportExam.addActionListener(new ActionListener() {
      @Override
      public void actionPerformed(ActionEvent e) {
          chooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
          int state = chooser.showSaveDialog(jf);
          File dir = chooser.getSelectedFile();
  
          if(state == JFileChooser.APPROVE_OPTION){
              try {
                  new ExamService().exportExam(exam, dir);
              } catch (Exception e1) {
                  e1.printStackTrace();
              }
          }
      }
  });
  ```

### 
